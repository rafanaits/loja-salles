<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>√Årea Administrativa - Loja Salles</title>
    <script src="auth.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .login-container {
            padding: 50px;
            text-align: center;
        }

        .login-form {
            max-width: 400px;
            margin: 0 auto;
            background: #f8f9fa;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
        }

        .form-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 1.1em;
            cursor: pointer;
            transition: transform 0.3s;
            width: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn-danger {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
        }

        .btn.btn-primary {
            background: linear-gradient(45deg, #ff1493, #00ff41);
            border: 2px solid #00ff41;
            box-shadow: 0 4px 12px rgba(255, 20, 147, 0.4);
            font-weight: bold;
        }

        .btn.btn-primary:hover {
            background: linear-gradient(45deg, #ff1493, #00ff41);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(255, 20, 147, 0.6);
        }

        .btn-success {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
        }

        .admin-panel {
            display: none;
            padding: 30px;
        }

        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #eee;
        }

        .admin-controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .products-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .products-table th {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        .products-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
        }

        .products-table tr:hover {
            background-color: #f8f9fa;
        }

        .product-form {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            display: none;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            background: white;
        }

        .status-badge {
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: bold;
            text-transform: uppercase;
        }

        .status-available {
            background: #d4edda;
            color: #155724;
        }

        .status-limited {
            background: #fff3cd;
            color: #856404;
        }

        .status-no-stock {
            background: #f8d7da;
            color: #721c24;
        }

        .action-buttons {
            display: flex;
            gap: 5px;
        }

        .btn-small {
            padding: 5px 10px;
            font-size: 0.8em;
            width: auto;
        }

        .back-to-main {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #667eea;
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            text-decoration: none;
            font-weight: bold;
            transition: transform 0.3s;
        }

        .back-to-main:hover {
            transform: translateY(-2px);
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 20px;
            display: none;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 20px;
            display: none;
        }

        /* Category Management Styles */
        .category-management {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .category-management h3 {
            color: #333;
            margin-bottom: 25px;
            font-size: 1.5em;
        }

        .category-management h4 {
            color: #555;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .category-form {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .categories-list {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .categories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .category-card {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
        }

        .category-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .category-icon-large {
            font-size: 2em;
            margin-bottom: 10px;
            display: block;
        }

        .category-name {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .category-description {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 10px;
        }

        .category-products-count {
            font-size: 0.8em;
            color: #667eea;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .category-actions {
            display: flex;
            gap: 5px;
            justify-content: center;
        }

        .delete-category-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.8em;
            cursor: pointer;
            transition: background 0.3s;
        }

        .delete-category-btn:hover {
            background: #c82333;
        }

        .category-card.protected {
            background: #fff3cd;
            border-color: #ffeaa7;
        }

        /* User Management Styles */
        .user-management {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .user-management h3 {
            color: #333;
            margin-bottom: 25px;
            font-size: 1.5em;
        }

        .user-management h4 {
            color: #555;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .user-form {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .users-list {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .change-password {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .users-table {
            margin-top: 15px;
            overflow-x: auto;
        }

        .users-table table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        .users-table th,
        .users-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }

        .users-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #333;
        }

        .users-table tr:hover {
            background: #f8f9fa;
        }

        .user-role {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 500;
        }

        .user-role.admin {
            background: #d4edda;
            color: #155724;
        }

        .user-role.funcionaria {
            background: #cce5ff;
            color: #004085;
        }

        .user-actions {
            display: flex;
            gap: 5px;
        }

        .user-actions button {
            padding: 5px 10px;
            font-size: 0.8em;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .user-actions .btn-danger {
            background: #dc3545;
            color: white;
        }

        .user-actions .btn-danger:hover {
            background: #c82333;
        }

        .user-actions .btn-warning {
            background: #ffc107;
            color: #212529;
        }

        .user-actions .btn-warning:hover {
            background: #e0a800;
        }

        .category-card.protected .delete-category-btn {
            display: none;
        }

        .protected-label {
            position: absolute;
            top: 5px;
            right: 5px;
            background: #ffc107;
            color: #856404;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 0.7em;
            font-weight: bold;
        }

        /* TXT Import Styles */
        .txt-import-section {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .txt-import-section h3 {
            color: #333;
            margin-bottom: 25px;
            font-size: 1.5em;
        }

        .txt-import-section h4 {
            color: #555;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .import-info {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .format-examples {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }

        .format-example {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .format-example pre {
            background: #e9ecef;
            padding: 10px;
            border-radius: 5px;
            font-size: 0.85em;
            margin-top: 8px;
            overflow-x: auto;
        }

        .import-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 25px 0;
        }

        .import-preview {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin: 25px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .import-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }

        .import-settings {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-top: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .setting-group {
            margin-bottom: 15px;
        }

        .setting-group label {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: normal;
            cursor: pointer;
        }

        .setting-group input[type="checkbox"] {
            width: auto;
            margin: 0;
        }

        .preview-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .preview-table th,
        .preview-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

        .preview-table th {
            background: #667eea;
            color: white;
        }

        .preview-table tr:nth-child(even) {
            background: #f9f9f9;
        }

        @media (max-width: 768px) {
            .admin-controls {
                flex-direction: column;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .action-buttons {
                flex-direction: column;
            }

            .categories-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Installment Management Styles */
        .installment-management {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .installment-management h3 {
            color: #333;
            margin-bottom: 25px;
            font-size: 1.5em;
        }

        .installment-management h4 {
            color: #555;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .installment-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
        }

        .installment-tab-btn {
            background: #e9ecef;
            border: 2px solid #dee2e6;
            color: #495057;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .installment-tab-btn:hover {
            background: #dee2e6;
            border-color: #adb5bd;
        }

        .installment-tab-btn.active {
            background: #007bff;
            border-color: #007bff;
            color: white;
        }

        .installment-tab-content {
            display: none;
        }

        .installment-tab-content.active {
            display: block;
        }

        .installment-rates-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .rate-item {
            display: flex;
            align-items: center;
            gap: 10px;
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }

        .rate-item label {
            font-weight: 600;
            color: #333;
            min-width: 40px;
        }

        .rate-item input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 14px;
        }

        .rate-item input:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
        }

        .rate-item span {
            color: #6c757d;
            font-weight: 600;
        }

        .installment-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 25px;
        }
    </style>
</head>
<body>
    <a href="precos_celulares.html" class="back-to-main">‚Üê Voltar para Vendas</a>
    
    <div class="container">
        <div class="header">
            <h1>üîê √Årea Administrativa</h1>
            <p>Gerenciamento de Produtos - Loja Salles</p>
        </div>

        <!-- Login Form -->
        <div id="loginContainer" class="login-container">
            <div class="login-form">
                <h2 style="margin-bottom: 30px; color: #333;">Acesso Administrativo</h2>
                <div id="errorMessage" class="error-message"></div>
                <form id="loginForm">
                    <div class="form-group">
                        <label for="username">Usu√°rio:</label>
                        <input type="text" id="username" name="username" required>
                    </div>
                    <div class="form-group">
                        <label for="password">Senha:</label>
                        <input type="password" id="password" name="password" required>
                    </div>
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 8px; font-weight: normal; font-size: 0.9em;">
                            <input type="checkbox" id="rememberMe" style="width: auto;">
                            Lembrar-me
                        </label>
                    </div>
                    <button type="submit" class="btn">Entrar</button>
                </form>
            </div>
        </div>

        <!-- Admin Panel -->
        <div id="adminPanel" class="admin-panel">
            <div class="admin-header">
                <h2>Gerenciamento de Produtos</h2>
                <div class="admin-controls">
                    <button class="btn btn-success" onclick="showAddForm()">+ Novo Produto</button>
                    <button class="btn" onclick="showCategoryManagement()">üè∑Ô∏è Gerenciar Categorias</button>
                    <button class="btn" onclick="showInstallmentManagement()">üí≥ Gerenciar Taxas de Parcelamento</button>
                    <button class="btn" onclick="showUserManagement()">üë• Gerenciar Usu√°rios</button>
                    <button class="btn" onclick="exportData()">üì• Exportar Dados</button>
                    <button class="btn" onclick="importData()" title="Importar arquivo JSON">üì§ Importar JSON</button>
                    <button class="btn btn-primary" onclick="showTxtImport()" title="Substituir todos os produtos por arquivo TXT">üîÑ Atualizar Produtos via TXT</button>
                    <button class="btn" onclick="loadCompleteProductList()">üìã Carregar Lista Completa</button>
                    <button class="btn btn-danger" onclick="logout()">Sair</button>
                </div>
            </div>

            <div id="successMessage" class="success-message"></div>

            <!-- Hidden file inputs for import -->
            <input type="file" id="fileInput" accept=".json" style="display: none;">
            <input type="file" id="txtFileInput" accept=".txt" style="display: none;">

            <!-- Installment Management -->
            <div id="installmentManagement" class="installment-management" style="display: none;">
                <h3>Gerenciamento de Taxas de Parcelamento</h3>
                
                <div class="installment-tabs">
                    <button class="installment-tab-btn active" onclick="showInstallmentTab('mastercard')">Mastercard/Visa</button>
                    <button class="installment-tab-btn" onclick="showInstallmentTab('others')">Outras Bandeiras</button>
                </div>
                
                <div id="mastercardTab" class="installment-tab-content active">
                    <h4>Taxas Mastercard/Visa</h4>
                    <div class="installment-rates-grid">
                        <div class="rate-item">
                            <label>1x:</label>
                            <input type="number" id="mastercard_1" step="0.01" min="0" max="100">
                            <span>%</span>
                        </div>
                        <div class="rate-item">
                            <label>2x:</label>
                            <input type="number" id="mastercard_2" step="0.01" min="0" max="100">
                            <span>%</span>
                        </div>
                        <div class="rate-item">
                            <label>3x:</label>
                            <input type="number" id="mastercard_3" step="0.01" min="0" max="100">
                            <span>%</span>
                        </div>
                        <div class="rate-item">
                            <label>4x:</label>
                            <input type="number" id="mastercard_4" step="0.01" min="0" max="100">
                            <span>%</span>
                        </div>
                        <div class="rate-item">
                            <label>5x:</label>
                            <input type="number" id="mastercard_5" step="0.01" min="0" max="100">
                            <span>%</span>
                        </div>
                        <div class="rate-item">
                            <label>6x:</label>
                            <input type="number" id="mastercard_6" step="0.01" min="0" max="100">
                            <span>%</span>
                        </div>
                        <div class="rate-item">
                            <label>7x:</label>
                            <input type="number" id="mastercard_7" step="0.01" min="0" max="100">
                            <span>%</span>
                        </div>
                        <div class="rate-item">
                            <label>8x:</label>
                            <input type="number" id="mastercard_8" step="0.01" min="0" max="100">
                            <span>%</span>
                        </div>
                        <div class="rate-item">
                            <label>9x:</label>
                            <input type="number" id="mastercard_9" step="0.01" min="0" max="100">
                            <span>%</span>
                        </div>
                        <div class="rate-item">
                            <label>10x:</label>
                            <input type="number" id="mastercard_10" step="0.01" min="0" max="100">
                            <span>%</span>
                        </div>
                        <div class="rate-item">
                            <label>11x:</label>
                            <input type="number" id="mastercard_11" step="0.01" min="0" max="100">
                            <span>%</span>
                        </div>
                        <div class="rate-item">
                            <label>12x:</label>
                            <input type="number" id="mastercard_12" step="0.01" min="0" max="100">
                            <span>%</span>
                        </div>
                    </div>
                </div>
                
                <div id="othersTab" class="installment-tab-content">
                    <h4>Taxas Outras Bandeiras</h4>
                    <div class="installment-rates-grid">
                        <div class="rate-item">
                            <label>1x:</label>
                            <input type="number" id="others_1" step="0.01" min="0" max="100">
                            <span>%</span>
                        </div>
                        <div class="rate-item">
                            <label>2x:</label>
                            <input type="number" id="others_2" step="0.01" min="0" max="100">
                            <span>%</span>
                        </div>
                        <div class="rate-item">
                            <label>3x:</label>
                            <input type="number" id="others_3" step="0.01" min="0" max="100">
                            <span>%</span>
                        </div>
                        <div class="rate-item">
                            <label>4x:</label>
                            <input type="number" id="others_4" step="0.01" min="0" max="100">
                            <span>%</span>
                        </div>
                        <div class="rate-item">
                            <label>5x:</label>
                            <input type="number" id="others_5" step="0.01" min="0" max="100">
                            <span>%</span>
                        </div>
                        <div class="rate-item">
                            <label>6x:</label>
                            <input type="number" id="others_6" step="0.01" min="0" max="100">
                            <span>%</span>
                        </div>
                        <div class="rate-item">
                            <label>7x:</label>
                            <input type="number" id="others_7" step="0.01" min="0" max="100">
                            <span>%</span>
                        </div>
                        <div class="rate-item">
                            <label>8x:</label>
                            <input type="number" id="others_8" step="0.01" min="0" max="100">
                            <span>%</span>
                        </div>
                        <div class="rate-item">
                            <label>9x:</label>
                            <input type="number" id="others_9" step="0.01" min="0" max="100">
                            <span>%</span>
                        </div>
                        <div class="rate-item">
                            <label>10x:</label>
                            <input type="number" id="others_10" step="0.01" min="0" max="100">
                            <span>%</span>
                        </div>
                        <div class="rate-item">
                            <label>11x:</label>
                            <input type="number" id="others_11" step="0.01" min="0" max="100">
                            <span>%</span>
                        </div>
                        <div class="rate-item">
                            <label>12x:</label>
                            <input type="number" id="others_12" step="0.01" min="0" max="100">
                            <span>%</span>
                        </div>
                    </div>
                </div>
                
                <div class="installment-actions">
                    <button class="btn btn-success" onclick="saveInstallmentRates()">üíæ Salvar Taxas</button>
                    <button class="btn" onclick="resetInstallmentRates()">üîÑ Resetar para Padr√£o</button>
                    <button class="btn btn-danger" onclick="hideInstallmentManagement()">‚ùå Fechar</button>
                </div>
            </div>

            <!-- TXT Import Section -->
            <div id="txtImportSection" class="txt-import-section" style="display: none;">
                <h3>üìÑ Atualiza√ß√£o Completa via TXT</h3>
                <p style="color: #dc3545; font-weight: bold; margin-bottom: 20px;">
                    ‚ö†Ô∏è Esta funcionalidade substitui COMPLETAMENTE todos os produtos pelos do arquivo TXT
                </p>
                
                <div class="import-info">
                    <h4>üìã Formatos Suportados:</h4>
                    <div class="format-examples">
                        <div class="format-example">
                            <strong>Formato 1 - Lista Simples:</strong>
                            <pre>iPhone 13 Pro Max 256GB Preto - R$ 4.500,00 - Estoque: 5
Samsung Galaxy S23 128GB Azul - R$ 3.200,00 - Estoque: 3</pre>
                        </div>
                        
                        <div class="format-example">
                            <strong>Formato 2 - Separado por Tabs:</strong>
                            <pre>iPhone	13 Pro Max	256GB	Preto	4500	5
Samsung	Galaxy S23	128GB	Azul	3200	3</pre>
                        </div>
                        
                        <div class="format-example">
                            <strong>Formato 3 - Separado por V√≠rgulas:</strong>
                            <pre>iPhone,13 Pro Max,256GB,Preto,4500,5
Samsung,Galaxy S23,128GB,Azul,3200,3</pre>
                        </div>
                        
                        <div class="format-example">
                            <strong>Formato 4 - Com Categoria:</strong>
                            <pre>iPhone - iPhone 13 Pro Max - 256GB - Preto - R$ 4.500,00 - 5 unidades
Samsung - Galaxy S23 - 128GB - Azul - R$ 3.200,00 - 3 unidades</pre>
                        </div>
                        
                        <div class="format-example">
                            <strong>Formato 5 - Seu Formato (Quantidade + Modelo + Storage/RAM + Cor + Pre√ßo):</strong>
                            <pre>08 Redmi A5 128/4 preto 540
19 Redmi A5 128/4 azul 540
03 Note 14 128/6 preto 840</pre>
                            <small style="color: #28a745; font-weight: bold;">
                                ‚úÖ Este formato substitui COMPLETAMENTE todos os produtos pelos do arquivo
                            </small>
                        </div>
                    </div>
                </div>

                <div class="import-controls">
                    <button class="btn btn-success" onclick="document.getElementById('txtFileInput').click()">
                        üìÅ Selecionar Arquivo TXT
                    </button>
                    <button class="btn" onclick="pasteFromClipboard()">
                        üìã Colar do Clipboard
                    </button>
                    <button class="btn" onclick="downloadExampleFile()">
                        üìÑ Baixar Arquivo de Exemplo
                    </button>
                </div>

                <div class="import-preview" id="importPreview" style="display: none;">
                    <h4>üîç Pr√©-visualiza√ß√£o dos Dados:</h4>
                    <div id="previewContent"></div>
                    <div class="import-actions">
                        <button class="btn btn-success" onclick="confirmImport()">üîÑ SUBSTITUIR TODOS OS PRODUTOS</button>
                        <button class="btn" onclick="cancelImport()">‚ùå Cancelar</button>
                    </div>
                </div>

                <div class="import-settings">
                    <h4>‚öôÔ∏è Modo de Importa√ß√£o:</h4>
                    <div class="setting-group">
                        <label style="color: #dc3545; font-weight: bold;">
                            <input type="checkbox" id="replaceAllProducts" checked>
                            üîÑ SUBSTITUIR TODOS OS PRODUTOS (Recomendado)
                        </label>
                        <small style="display: block; margin-left: 25px; color: #666;">
                            Remove todos os produtos atuais e mant√©m apenas os do arquivo TXT
                        </small>
                    </div>
                    <div class="setting-group">
                        <label>
                            <input type="checkbox" id="updateExisting">
                            Atualizar produtos existentes (modo incremental)
                        </label>
                    </div>
                    <div class="setting-group">
                        <label>
                            <input type="checkbox" id="addNewProducts">
                            Adicionar novos produtos (modo incremental)
                        </label>
                    </div>
                    <div class="setting-group">
                        <label>
                            <input type="checkbox" id="updateStockOnly">
                            Atualizar apenas estoque (manter pre√ßos)
                        </label>
                    </div>
                </div>
            </div>

            <!-- Category Management -->
            <div id="categoryManagement" class="category-management" style="display: none;">
                <h3>Gerenciamento de Categorias</h3>
                
                <!-- Add New Category -->
                <div class="category-form">
                    <h4>Adicionar Nova Categoria</h4>
                    <form id="categoryForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="categoryName">Nome da Categoria:</label>
                                <input type="text" id="categoryName" name="categoryName" required placeholder="Ex: iPhone, Samsung, etc.">
                            </div>
                            <div class="form-group">
                                <label for="categoryIcon">√çcone:</label>
                                <input type="text" id="categoryIcon" name="categoryIcon" placeholder="Ex: üì±, üçé, etc.">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="categoryDescription">Descri√ß√£o:</label>
                                <input type="text" id="categoryDescription" name="categoryDescription" placeholder="Descri√ß√£o opcional">
                            </div>
                            <div class="form-group">
                                <label>&nbsp;</label>
                                <button type="submit" class="btn btn-success">Adicionar Categoria</button>
                            </div>
                        </div>
                    </form>
                </div>

                <!-- Categories List -->
                <div class="categories-list">
                    <h4>Categorias Existentes</h4>
                    <div class="categories-grid" id="categoriesGrid">
                        <!-- Categories will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- User Management -->
            <div id="userManagement" class="user-management" style="display: none;">
                <h3>üë• Gerenciamento de Usu√°rios</h3>
                
                <!-- Add New User -->
                <div class="user-form">
                    <h4>Adicionar Novo Usu√°rio</h4>
                    <form id="userForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="newUsername">Nome de Usu√°rio:</label>
                                <input type="text" id="newUsername" name="newUsername" required placeholder="Ex: funcionaria3">
                            </div>
                            <div class="form-group">
                                <label for="newPassword">Senha:</label>
                                <input type="password" id="newPassword" name="newPassword" required placeholder="M√≠nimo 6 caracteres">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="userRole">Tipo de Acesso:</label>
                                <select id="userRole" name="userRole" required>
                                    <option value="funcionaria">Funcion√°ria (Acesso √†s p√°ginas)</option>
                                    <option value="admin">Administrador (Acesso completo)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>&nbsp;</label>
                                <button type="submit" class="btn btn-success">Adicionar Usu√°rio</button>
                            </div>
                        </div>
                    </form>
                </div>

                <!-- Users List -->
                <div class="users-list">
                    <h4>Usu√°rios Existentes</h4>
                    <div class="users-table">
                        <table>
                            <thead>
                                <tr>
                                    <th>Usu√°rio</th>
                                    <th>Tipo</th>
                                    <th>√öltimo Acesso</th>
                                    <th>A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="usersTableBody">
                                <!-- Users will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Change Password -->
                <div class="change-password">
                    <h4>Alterar Senha de Usu√°rio</h4>
                    <form id="changePasswordForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="changeUserSelect">Usu√°rio:</label>
                                <select id="changeUserSelect" name="changeUserSelect" required>
                                    <option value="">Selecione um usu√°rio</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="newPasswordConfirm">Nova Senha:</label>
                                <input type="password" id="newPasswordConfirm" name="newPasswordConfirm" required placeholder="Nova senha">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>&nbsp;</label>
                                <button type="submit" class="btn btn-warning">Alterar Senha</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Product Form -->
            <div id="productForm" class="product-form">
                <h3 id="formTitle">Adicionar Novo Produto</h3>
                <form id="productFormElement">
                    <input type="hidden" id="productId">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="category">Categoria:</label>
                            <select id="category" name="category" required>
                                <option value="">Selecione uma categoria</option>
                                <!-- CELULARES -->
                                <optgroup label="üì± Celulares">
                                    <option value="Redmi">Redmi</option>
                                    <option value="Note">Note</option>
                                    <option value="Poco">Poco</option>
                                    <option value="Realme">Realme</option>
                                    <option value="Honor">Honor</option>
                                    <option value="Infinix">Infinix</option>
                                    <option value="iPhone">iPhone</option>
                                    <option value="Samsung">Samsung</option>
                                    <option value="Apple Watch">Apple Watch</option>
                                    <option value="iPad">iPad</option>
                                    <option value="MacBook">MacBook</option>
                                    <option value="Tablet">Tablet</option>
                                </optgroup>
                                <!-- GAMES -->
                                <optgroup label="üéÆ Games">
                                    <option value="PlayStation">PlayStation</option>
                                    <option value="Xbox">Xbox</option>
                                    <option value="Nintendo">Nintendo</option>
                                </optgroup>
                                <!-- JBL -->
                                <optgroup label="üîä JBL">
                                    <option value="JBL">JBL</option>
                                </optgroup>
                                <!-- OUTROS -->
                                <optgroup label="üîß Outros">
                                    <option value="Robot Xiaomi">Robot Xiaomi</option>
                                    <option value="Starlink">Starlink</option>
                                </optgroup>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="model">Modelo:</label>
                            <input type="text" id="model" name="model" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="storage">Armazenamento:</label>
                            <input type="text" id="storage" name="storage" placeholder="Ex: 128GB">
                        </div>
                        <div class="form-group">
                            <label for="ram">RAM:</label>
                            <input type="text" id="ram" name="ram" placeholder="Ex: 4GB">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="color">Cor:</label>
                            <input type="text" id="color" name="color" placeholder="Ex: Preto, Azul, Gold">
                        </div>
                        <div class="form-group">
                            <label for="price">Pre√ßo (R$):</label>
                            <input type="number" id="price" name="price" step="0.01" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="quantity">Quantidade em Estoque:</label>
                            <input type="number" id="quantity" name="quantity" min="0" required>
                        </div>
                        <div class="form-group">
                            <label for="status">Status:</label>
                            <select id="status" name="status" required>
                                <option value="available">Dispon√≠vel</option>
                                <option value="limited">Poucas Unidades</option>
                                <option value="no-stock">Sem Estoque</option>
                            </select>
                        </div>
                    </div>
                    <div style="display: flex; gap: 15px; margin-top: 20px;">
                        <button type="submit" class="btn btn-success">Salvar Produto</button>
                        <button type="button" class="btn btn-danger" onclick="cancelForm()">Cancelar</button>
                    </div>
                </form>
            </div>

            <!-- Products Table -->
            <table class="products-table">
                <thead>
                    <tr>
                        <th>Categoria</th>
                        <th>Modelo</th>
                        <th>Especifica√ß√µes</th>
                        <th>Cor</th>
                        <th>Pre√ßo</th>
                        <th>Estoque</th>
                        <th>Status</th>
                        <th>A√ß√µes</th>
                    </tr>
                </thead>
                <tbody id="productsTableBody">
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // === SISTEMA DE BANCO DE DADOS LOCAL ===
        let db;
        
        // Inicializar banco de dados
        function initDatabase() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open('SallesInformaticaDB', 1);
                
                request.onerror = () => reject(request.error);
                request.onsuccess = () => {
                    db = request.result;
                    resolve(db);
                };
                
                request.onupgradeneeded = (event) => {
                    const database = event.target.result;
                    
                    // Store para credenciais de administrador
                    if (!database.objectStoreNames.contains('adminCredentials')) {
                        const adminStore = database.createObjectStore('adminCredentials', { keyPath: 'id' });
                        adminStore.createIndex('username', 'username', { unique: true });
                    }
                    
                    // Store para configura√ß√µes do sistema
                    if (!database.objectStoreNames.contains('systemSettings')) {
                        database.createObjectStore('systemSettings', { keyPath: 'key' });
                    }
                };
            });
        }
        
        // Salvar credenciais no banco de dados
        async function saveCredentials(username, password) {
            try {
                if (!db) await initDatabase();
                
                const transaction = db.transaction(['adminCredentials'], 'readwrite');
                const store = transaction.objectStore('adminCredentials');
                
                const credentials = {
                    id: 'admin',
                    username: username,
                    password: password,
                    rememberLogin: true,
                    lastLogin: new Date().toISOString()
                };
                
                await new Promise((resolve, reject) => {
                    const request = store.put(credentials);
                    request.onsuccess = () => resolve();
                    request.onerror = () => reject(request.error);
                });
                
                console.log('Credenciais salvas no banco de dados');
            } catch (error) {
                console.error('Erro ao salvar credenciais:', error);
                // Fallback para localStorage
                localStorage.setItem('rememberedUsername', username);
                localStorage.setItem('rememberedPassword', password);
                localStorage.setItem('rememberLogin', 'true');
            }
        }
        
        // Carregar credenciais do banco de dados
        async function loadCredentials() {
            try {
                if (!db) await initDatabase();
                
                const transaction = db.transaction(['adminCredentials'], 'readonly');
                const store = transaction.objectStore('adminCredentials');
                
                const credentials = await new Promise((resolve, reject) => {
                    const request = store.get('admin');
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
                
                if (credentials && credentials.rememberLogin) {
                    document.getElementById('username').value = credentials.username;
                    document.getElementById('password').value = credentials.password;
                    document.getElementById('rememberMe').checked = true;
                    console.log('Credenciais carregadas do banco de dados');
                }
            } catch (error) {
                console.error('Erro ao carregar credenciais:', error);
                // Fallback para localStorage
                const rememberLogin = localStorage.getItem('rememberLogin');
                if (rememberLogin === 'true') {
                    const username = localStorage.getItem('rememberedUsername');
                    const password = localStorage.getItem('rememberedPassword');
                    if (username && password) {
                        document.getElementById('username').value = username;
                        document.getElementById('password').value = password;
                        document.getElementById('rememberMe').checked = true;
                    }
                }
            }
        }
        
        // Configura√ß√µes de login padr√£o (primeira vez)
        const DEFAULT_USERNAME = 'admin';
        const DEFAULT_PASSWORD = 'lojasalles2024';
        
        // Fun√ß√£o para limpar credenciais salvas
        function clearCredentials() {
            localStorage.removeItem('rememberedUsername');
            localStorage.removeItem('rememberedPassword');
            localStorage.removeItem('rememberLogin');
        }

        // Vari√°veis globais
        let products = JSON.parse(localStorage.getItem('products')) || [];
        let isEditing = false;
        let categories = JSON.parse(localStorage.getItem('categories')) || getDefaultCategories();

        // Categorias padr√£o (protegidas)
        function getDefaultCategories() {
            return [
                // CELULARES
                {name: 'Redmi', icon: 'üì±', description: 'Smartphones Xiaomi Redmi', protected: true},
                {name: 'Note', icon: 'üìù', description: 'Linha Note Xiaomi', protected: true},
                {name: 'Poco', icon: '‚ö°', description: 'Smartphones Poco', protected: true},
                {name: 'Realme', icon: 'üîµ', description: 'Smartphones Realme', protected: true},
                {name: 'Honor', icon: 'üèÜ', description: 'Smartphones Honor', protected: true},
                {name: 'Infinix', icon: 'üì≤', description: 'Smartphones Infinix', protected: true},
                {name: 'iPhone', icon: 'üçé', description: 'Smartphones Apple', protected: true},
                {name: 'Samsung', icon: 'üì±', description: 'Smartphones Samsung', protected: true},
                {name: 'Apple Watch', icon: '‚åö', description: 'Rel√≥gios Apple', protected: true},
                {name: 'iPad', icon: 'üì±', description: 'Tablets Apple', protected: true},
                {name: 'MacBook', icon: 'üíª', description: 'Notebooks Apple', protected: true},
                {name: 'Tablet', icon: 'üì±', description: 'Outros tablets', protected: true},
                
                // GAMES
                {name: 'PlayStation', icon: 'üïπÔ∏è', description: 'Consoles Sony PlayStation', protected: true},
                {name: 'Xbox', icon: 'üéÆ', description: 'Consoles Microsoft Xbox', protected: true},
                {name: 'Nintendo', icon: 'üéÆ', description: 'Consoles Nintendo', protected: true},
                
                // JBL
                {name: 'JBL', icon: 'üîä', description: 'Caixas de som JBL', protected: true},
                
                // OUTROS
                {name: 'Robot Xiaomi', icon: 'ü§ñ', description: 'Aspiradores Xiaomi', protected: true},
                {name: 'Starlink', icon: 'üì°', description: 'Internet via sat√©lite', protected: true}
            ];
        }

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', async function() {
            // Inicializar banco de dados
            try {
                await initDatabase();
                console.log('Banco de dados inicializado com sucesso');
            } catch (error) {
                console.error('Erro ao inicializar banco de dados:', error);
            }
            
            // Carregar credenciais salvas
            await loadCredentials();
            
            if (products.length === 0) {
                loadDefaultProducts();
            }
            loadProductsTable();
            
            // Configurar formul√°rio de categoria
            document.getElementById('categoryForm').addEventListener('submit', handleCategorySubmit);
            
            // Configurar formul√°rios de usu√°rios
            setupUserForms();
            
            // Configurar input de arquivo TXT
            document.getElementById('txtFileInput').addEventListener('change', handleTxtFileSelect);
        });

        // Fun√ß√µes de gerenciamento de categorias
        function showCategoryManagement() {
            document.getElementById('categoryManagement').style.display = 'block';
            document.getElementById('productForm').style.display = 'none';
            loadCategoriesGrid();
        }

        function handleCategorySubmit(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const categoryName = formData.get('categoryName').trim();
            const categoryIcon = formData.get('categoryIcon').trim() || 'üì¶';
            const categoryDescription = formData.get('categoryDescription').trim() || '';
            
            // Verificar se categoria j√° existe
            if (categories.find(cat => cat.name.toLowerCase() === categoryName.toLowerCase())) {
                showMessage('errorMessage', 'Esta categoria j√° existe!');
                return;
            }
            
            // Adicionar nova categoria
            const newCategory = {
                name: categoryName,
                icon: categoryIcon,
                description: categoryDescription,
                protected: false
            };
            
            categories.push(newCategory);
            localStorage.setItem('categories', JSON.stringify(categories));
            
            // Limpar formul√°rio
            e.target.reset();
            
            // Atualizar grid de categorias
            loadCategoriesGrid();
            
            // Atualizar select de categorias no formul√°rio de produtos
            updateCategorySelect();
            
            showMessage('successMessage', `Categoria "${categoryName}" adicionada com sucesso!`);
        }

        function loadCategoriesGrid() {
            const grid = document.getElementById('categoriesGrid');
            grid.innerHTML = '';
            
            categories.forEach(category => {
                const productCount = products.filter(p => p.category === category.name).length;
                
                const card = document.createElement('div');
                card.className = `category-card ${category.protected ? 'protected' : ''}`;
                
                card.innerHTML = `
                    ${category.protected ? '<div class="protected-label">Protegida</div>' : ''}
                    <div class="category-icon-large">${category.icon}</div>
                    <div class="category-name">${category.name}</div>
                    <div class="category-description">${category.description}</div>
                    <div class="category-products-count">${productCount} produto(s)</div>
                    ${!category.protected ? `
                        <div class="category-actions">
                            <button class="delete-category-btn" onclick="deleteCategory('${category.name}')">
                                Excluir
                            </button>
                        </div>
                    ` : ''}
                `;
                
                grid.appendChild(card);
            });
        }

        function deleteCategory(categoryName) {
            if (confirm(`Tem certeza que deseja excluir a categoria "${categoryName}"?\n\nIsso ir√° remover todos os produtos desta categoria!`)) {
                // Remover produtos desta categoria
                products = products.filter(p => p.category !== categoryName);
                localStorage.setItem('products', JSON.stringify(products));
                
                // Remover categoria
                categories = categories.filter(cat => cat.name !== categoryName);
                localStorage.setItem('categories', JSON.stringify(categories));
                
                // Atualizar interface
                loadCategoriesGrid();
                loadProductsTable();
                updateCategorySelect();
                
                showMessage('successMessage', `Categoria "${categoryName}" e todos os seus produtos foram removidos!`);
            }
        }

        function updateCategorySelect() {
            const categorySelect = document.getElementById('category');
            if (categorySelect) {
                const currentValue = categorySelect.value;
                categorySelect.innerHTML = '<option value="">Selecione uma categoria</option>';
                
                // Agrupar categorias por se√ß√£o
                const celulares = categories.filter(cat => 
                    ['Redmi', 'Note', 'Poco', 'Realme', 'Honor', 'Infinix', 'iPhone', 'Samsung', 'Apple Watch', 'iPad', 'MacBook', 'Tablet'].includes(cat.name)
                );
                const games = categories.filter(cat => 
                    ['PlayStation', 'Xbox', 'Nintendo'].includes(cat.name)
                );
                const jbl = categories.filter(cat => 
                    ['JBL'].includes(cat.name)
                );
                const outros = categories.filter(cat => 
                    !['Redmi', 'Note', 'Poco', 'Realme', 'Honor', 'Infinix', 'iPhone', 'Samsung', 'Apple Watch', 'iPad', 'MacBook', 'Tablet', 'PlayStation', 'Xbox', 'Nintendo', 'JBL'].includes(cat.name)
                );
                
                // Adicionar grupos
                if (celulares.length > 0) {
                    const celularesGroup = document.createElement('optgroup');
                    celularesGroup.label = 'üì± Celulares';
                    celulares.forEach(category => {
                        const option = document.createElement('option');
                        option.value = category.name;
                        option.textContent = `${category.icon} ${category.name}`;
                        celularesGroup.appendChild(option);
                    });
                    categorySelect.appendChild(celularesGroup);
                }
                
                if (games.length > 0) {
                    const gamesGroup = document.createElement('optgroup');
                    gamesGroup.label = 'üéÆ Games';
                    games.forEach(category => {
                        const option = document.createElement('option');
                        option.value = category.name;
                        option.textContent = `${category.icon} ${category.name}`;
                        gamesGroup.appendChild(option);
                    });
                    categorySelect.appendChild(gamesGroup);
                }
                
                if (jbl.length > 0) {
                    const jblGroup = document.createElement('optgroup');
                    jblGroup.label = 'üîä JBL';
                    jbl.forEach(category => {
                        const option = document.createElement('option');
                        option.value = category.name;
                        option.textContent = `${category.icon} ${category.name}`;
                        jblGroup.appendChild(option);
                    });
                    categorySelect.appendChild(jblGroup);
                }
                
                if (outros.length > 0) {
                    const outrosGroup = document.createElement('optgroup');
                    outrosGroup.label = 'üîß Outros';
                    outros.forEach(category => {
                        const option = document.createElement('option');
                        option.value = category.name;
                        option.textContent = `${category.icon} ${category.name}`;
                        outrosGroup.appendChild(option);
                    });
                    categorySelect.appendChild(outrosGroup);
                }
                
                // Restaurar valor selecionado se ainda existir
                if (categories.find(cat => cat.name === currentValue)) {
                    categorySelect.value = currentValue;
                }
            }
        }

        // === SISTEMA DE GERENCIAMENTO DE USU√ÅRIOS ===
        
        // Carregar usu√°rios do localStorage
        function loadUsers() {
            return JSON.parse(localStorage.getItem('users')) || [
                { username: 'admin', password: 'admin123', role: 'admin', lastLogin: null },
                { username: 'funcionaria1', password: 'func123', role: 'funcionaria', lastLogin: null },
                { username: 'funcionaria2', password: 'func123', role: 'funcionaria', lastLogin: null },
                { username: 'vendedora', password: 'vend123', role: 'funcionaria', lastLogin: null }
            ];
        }

        // Salvar usu√°rios no localStorage
        function saveUsers(users) {
            localStorage.setItem('users', JSON.stringify(users));
        }

        // Mostrar gerenciamento de usu√°rios
        function showUserManagement() {
            document.getElementById('userManagement').style.display = 'block';
            document.getElementById('productForm').style.display = 'none';
            document.getElementById('categoryManagement').style.display = 'none';
            document.getElementById('installmentManagement').style.display = 'none';
            document.getElementById('txtImportSection').style.display = 'none';
            
            loadUsersTable();
            loadChangePasswordSelect();
        }

        // Carregar tabela de usu√°rios
        function loadUsersTable() {
            const users = loadUsers();
            const tbody = document.getElementById('usersTableBody');
            tbody.innerHTML = '';

            users.forEach(user => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${user.username}</td>
                    <td><span class="user-role ${user.role}">${user.role === 'admin' ? 'Administrador' : 'Funcion√°ria'}</span></td>
                    <td>${user.lastLogin ? new Date(user.lastLogin).toLocaleString('pt-BR') : 'Nunca'}</td>
                    <td>
                        <div class="user-actions">
                            <button class="btn-warning" onclick="changeUserPassword('${user.username}')">Alterar Senha</button>
                            ${user.username !== 'admin' ? `<button class="btn-danger" onclick="deleteUser('${user.username}')">Excluir</button>` : ''}
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Carregar select para alterar senha
        function loadChangePasswordSelect() {
            const users = loadUsers();
            const select = document.getElementById('changeUserSelect');
            select.innerHTML = '<option value="">Selecione um usu√°rio</option>';

            users.forEach(user => {
                const option = document.createElement('option');
                option.value = user.username;
                option.textContent = `${user.username} (${user.role === 'admin' ? 'Administrador' : 'Funcion√°ria'})`;
                select.appendChild(option);
            });
        }

        // Adicionar novo usu√°rio
        function addUser(username, password, role) {
            const users = loadUsers();
            
            // Verificar se usu√°rio j√° existe
            if (users.find(u => u.username === username)) {
                showMessage('errorMessage', 'Este nome de usu√°rio j√° existe!');
                return false;
            }

            // Validar senha
            if (password.length < 6) {
                showMessage('errorMessage', 'A senha deve ter pelo menos 6 caracteres!');
                return false;
            }

            // Adicionar usu√°rio
            const newUser = {
                username: username,
                password: password,
                role: role,
                lastLogin: null
            };

            users.push(newUser);
            saveUsers(users);
            
            showMessage('successMessage', `Usu√°rio "${username}" adicionado com sucesso!`);
            return true;
        }

        // Excluir usu√°rio
        function deleteUser(username) {
            if (username === 'admin') {
                showMessage('errorMessage', 'N√£o √© poss√≠vel excluir o usu√°rio administrador!');
                return;
            }

            if (confirm(`Tem certeza que deseja excluir o usu√°rio "${username}"?`)) {
                const users = loadUsers();
                const filteredUsers = users.filter(u => u.username !== username);
                saveUsers(filteredUsers);
                
                loadUsersTable();
                loadChangePasswordSelect();
                
                showMessage('successMessage', `Usu√°rio "${username}" exclu√≠do com sucesso!`);
            }
        }

        // Alterar senha de usu√°rio
        function changeUserPassword(username, newPassword) {
            const users = loadUsers();
            const userIndex = users.findIndex(u => u.username === username);
            
            if (userIndex === -1) {
                showMessage('errorMessage', 'Usu√°rio n√£o encontrado!');
                return false;
            }

            if (newPassword.length < 6) {
                showMessage('errorMessage', 'A senha deve ter pelo menos 6 caracteres!');
                return false;
            }

            users[userIndex].password = newPassword;
            saveUsers(users);
            
            showMessage('successMessage', `Senha do usu√°rio "${username}" alterada com sucesso!`);
            return true;
        }

        // Configurar formul√°rios de usu√°rios
        function setupUserForms() {
            // Formul√°rio de adicionar usu√°rio
            document.getElementById('userForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const formData = new FormData(e.target);
                const username = formData.get('newUsername').trim();
                const password = formData.get('newPassword');
                const role = formData.get('userRole');
                
                if (addUser(username, password, role)) {
                    e.target.reset();
                    loadUsersTable();
                    loadChangePasswordSelect();
                }
            });

            // Formul√°rio de alterar senha
            document.getElementById('changePasswordForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const formData = new FormData(e.target);
                const username = formData.get('changeUserSelect');
                const newPassword = formData.get('newPasswordConfirm');
                
                if (changeUserPassword(username, newPassword)) {
                    e.target.reset();
                    loadUsersTable();
                }
            });
        }

        // === SISTEMA DE IMPORTA√á√ÉO TXT INTELIGENTE ===
        
        let parsedData = [];
        let importMode = 'add'; // 'add', 'update', 'stock-only'

        function showTxtImport() {
            document.getElementById('txtImportSection').style.display = 'block';
            document.getElementById('productForm').style.display = 'none';
            document.getElementById('categoryManagement').style.display = 'none';
            document.getElementById('importPreview').style.display = 'none';
        }

        function handleTxtFileSelect(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const content = e.target.result;
                    processTxtContent(content);
                };
                reader.readAsText(file);
            }
        }

        function pasteFromClipboard() {
            navigator.clipboard.readText().then(text => {
                processTxtContent(text);
            }).catch(err => {
                alert('Erro ao acessar clipboard. Tente copiar e colar manualmente.');
            });
        }

        function processTxtContent(content) {
            const lines = content.split('\n').filter(line => line.trim());
            parsedData = [];
            
            lines.forEach((line, index) => {
                const product = parseProductLine(line.trim());
                if (product) {
                    parsedData.push(product);
                }
            });
            
            if (parsedData.length > 0) {
                showImportPreview();
            } else {
                alert('Nenhum produto v√°lido encontrado no arquivo!');
            }
        }

        function parseProductLine(line) {
            // Formato 1: iPhone 13 Pro Max 256GB Preto - R$ 4.500,00 - Estoque: 5
            let match = line.match(/(.+?)\s+(\d+GB)\s+(.+?)\s+-\s+R\$\s+([\d.,]+)\s+-\s+Estoque:\s+(\d+)/);
            if (match) {
                return {
                    category: extractCategory(match[1]),
                    model: match[1].trim(),
                    storage: match[2],
                    color: match[3],
                    price: parsePrice(match[4]),
                    quantity: parseInt(match[5])
                };
            }

            // Formato 2: iPhone - iPhone 13 Pro Max - 256GB - Preto - R$ 4.500,00 - 5 unidades
            match = line.match(/(.+?)\s+-\s+(.+?)\s+-\s+(\d+GB)\s+-\s+(.+?)\s+-\s+R\$\s+([\d.,]+)\s+-\s+(\d+)\s+unidades/);
            if (match) {
                return {
                    category: match[1].trim(),
                    model: match[2].trim(),
                    storage: match[3],
                    color: match[4],
                    price: parsePrice(match[5]),
                    quantity: parseInt(match[6])
                };
            }

            // NOVO FORMATO: 08 Redmi A5 128/4 preto 540 (com espa√ßos extras e caracteres especiais)
            match = line.match(/^(\d+)\s+([A-Za-z√°√™√¥√ß√£\s]+?)\s+(\d+\/\d+)\s+([a-z√°√™√¥√ß√£\s]+?)\s+(\d+)$/);
            if (match) {
                const quantity = parseInt(match[1]);
                const fullModel = match[2].trim().replace(/\s+/g, ' ');
                const storageRam = match[3];
                const color = match[4].trim().replace(/\s+/g, ' ');
                const price = parseInt(match[5]);
                
                // Extrair marca e modelo
                const brandModel = extractBrandAndModel(fullModel);
                
                return {
                    category: brandModel.brand,
                    model: brandModel.model,
                    storage: storageRam,
                    color: color,
                    price: price,
                    quantity: quantity
                };
            }

            // FORMATO ESPECIAL: 00 PlayStation m√≠dia digital slim 1tb com jogo astro bot 3600
            match = line.match(/^(\d+)\s+([A-Za-z√°√™√¥√ß√£\s]+?)\s+([a-z√°√™√¥√ß√£\s]+?)\s+(\d+)$/);
            if (match && !line.includes('/')) {
                const quantity = parseInt(match[1]);
                const fullModel = match[2].trim().replace(/\s+/g, ' ');
                const description = match[3].trim().replace(/\s+/g, ' ');
                const price = parseInt(match[4]);
                
                // Extrair marca e modelo
                const brandModel = extractBrandAndModel(fullModel);
                
                return {
                    category: brandModel.brand,
                    model: `${brandModel.model} ${description}`,
                    storage: 'N/A',
                    color: 'N/A',
                    price: price,
                    quantity: quantity
                };
            }

            // Formato 3: Separado por tabs - iPhone	13 Pro Max	256GB	Preto	4500	5
            if (line.includes('\t')) {
                const parts = line.split('\t');
                if (parts.length >= 6) {
                    return {
                        category: parts[0].trim(),
                        model: parts[1].trim(),
                        storage: parts[2].trim(),
                        color: parts[3].trim(),
                        price: parseFloat(parts[4]) || 0,
                        quantity: parseInt(parts[5]) || 0
                    };
                }
            }

            // Formato 4: Separado por v√≠rgulas - iPhone,13 Pro Max,256GB,Preto,4500,5
            if (line.includes(',') && !line.includes(' - ')) {
                const parts = line.split(',');
                if (parts.length >= 6) {
                    return {
                        category: parts[0].trim(),
                        model: parts[1].trim(),
                        storage: parts[2].trim(),
                        color: parts[3].trim(),
                        price: parseFloat(parts[4]) || 0,
                        quantity: parseInt(parts[5]) || 0
                    };
                }
            }

            return null;
        }

        function extractBrandAndModel(fullModel) {
            const brands = {
                'Redmi': 'Redmi',
                'Note': 'Note',
                'Poco': 'Poco',
                'Realme': 'Realme',
                'Honor': 'Honor',
                'Infinix': 'Infinix',
                'iPhone': 'iPhone',
                'Samsung': 'Samsung',
                'Galaxy': 'Samsung',
                'Apple': 'iPhone',
                'iPad': 'iPad',
                'Mac': 'MacBook',
                'PlayStation': 'PlayStation',
                'Xbox': 'Xbox',
                'Nintendo': 'Nintendo',
                'JBL': 'JBL',
                'Robot': 'Robot Xiaomi',
                'Starlink': 'Starlink',
                'serie': 'Apple Watch',
                's√©rie': 'Apple Watch'
            };

            // Encontrar a marca
            for (const [key, brand] of Object.entries(brands)) {
                if (fullModel.toLowerCase().includes(key.toLowerCase())) {
                    let model = fullModel.replace(new RegExp(key, 'i'), '').trim();
                    // Se o modelo ficar vazio, usar a marca como modelo
                    if (!model) {
                        model = key;
                    }
                    return { brand, model };
                }
            }

            // Se n√£o encontrar marca espec√≠fica, usar a primeira palavra
            const parts = fullModel.split(' ');
            return { 
                brand: parts[0], 
                model: parts.slice(1).join(' ') || parts[0] 
            };
        }

        function extractCategory(modelText) {
            const categoryMap = {
                'iPhone': 'iPhone',
                'Samsung': 'Samsung',
                'Galaxy': 'Samsung',
                'Redmi': 'Redmi',
                'Note': 'Note',
                'Poco': 'Poco',
                'Realme': 'Realme',
                'Honor': 'Honor',
                'Infinix': 'Infinix',
                'Apple Watch': 'Apple Watch',
                'serie': 'Apple Watch',
                's√©rie': 'Apple Watch',
                'iPad': 'iPad',
                'MacBook': 'MacBook',
                'PlayStation': 'PlayStation',
                'Xbox': 'Xbox',
                'Nintendo': 'Nintendo',
                'JBL': 'JBL',
                'Robot': 'Robot Xiaomi',
                'Starlink': 'Starlink'
            };

            for (const [key, category] of Object.entries(categoryMap)) {
                if (modelText.toLowerCase().includes(key.toLowerCase())) {
                    return category;
                }
            }
            return 'Outros';
        }

        function parsePrice(priceStr) {
            return parseFloat(priceStr.replace(/[^\d.,]/g, '').replace(',', '.')) || 0;
        }

        function extractRamFromStorage(storageStr) {
            // Se o formato for "128/4" ou "256/8", extrair o RAM
            const match = storageStr.match(/(\d+)\/(\d+)/);
            if (match) {
                return `${match[2]}GB`;
            }
            
            // Se for apenas "128GB", tentar inferir RAM baseado no storage
            const storageMatch = storageStr.match(/(\d+)GB/);
            if (storageMatch) {
                const storage = parseInt(storageMatch[1]);
                if (storage <= 64) return '3GB';
                if (storage <= 128) return '4GB';
                if (storage <= 256) return '6GB';
                return '8GB';
            }
            
            // Se for "N/A" ou vazio, retornar "N/A"
            if (storageStr === 'N/A' || !storageStr) {
                return 'N/A';
            }
            
            return 'N/A';
        }

        function showImportPreview() {
            const previewContent = document.getElementById('previewContent');
            let html = '<table class="preview-table">';
            html += '<thead><tr><th>Categoria</th><th>Modelo</th><th>Storage</th><th>Cor</th><th>Pre√ßo</th><th>Estoque</th></tr></thead><tbody>';
            
            parsedData.forEach(product => {
                html += `<tr>
                    <td>${product.category}</td>
                    <td>${product.model}</td>
                    <td>${product.storage}</td>
                    <td>${product.color}</td>
                    <td>R$ ${product.price.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</td>
                    <td>${product.quantity}</td>
                </tr>`;
            });
            
            html += '</tbody></table>';
            previewContent.innerHTML = html;
            document.getElementById('importPreview').style.display = 'block';
        }

        function confirmImport() {
            const replaceAllProducts = document.getElementById('replaceAllProducts').checked;
            const updateExisting = document.getElementById('updateExisting').checked;
            const addNewProducts = document.getElementById('addNewProducts').checked;
            const updateStockOnly = document.getElementById('updateStockOnly').checked;
            
            // NOVA FUNCIONALIDADE: Substituir completamente os produtos
            if (replaceAllProducts) {
                if (confirm(`‚ö†Ô∏è ATEN√á√ÉO: Esta opera√ß√£o ir√° SUBSTITUIR COMPLETAMENTE todos os produtos atuais pelos produtos do arquivo TXT.\n\nProdutos atuais: ${products.length}\nProdutos do TXT: ${parsedData.length}\n\nProdutos que n√£o est√£o no TXT ser√£o REMOVIDOS da lista.\n\nDeseja continuar?`)) {
                    
                        // Converter dados do TXT para o formato completo de produtos
                        const newProducts = parsedData.map((newProduct, index) => {
                            // Determinar status baseado na quantidade
                            let status = 'no-stock';
                            if (newProduct.quantity > 10) {
                                status = 'available';
                            } else if (newProduct.quantity > 0) {
                                status = 'limited';
                            }
                            
                            return {
                                id: `txt_${Date.now()}_${index}`,
                                category: newProduct.category,
                                model: newProduct.model,
                                storage: newProduct.storage || 'N/A',
                                ram: extractRamFromStorage(newProduct.storage || 'N/A'),
                                color: newProduct.color || 'N/A',
                                price: newProduct.price,
                                quantity: newProduct.quantity,
                                status: status
                            };
                        });
                    
                    // SUBSTITUIR COMPLETAMENTE os produtos
                    products = newProducts;
                    localStorage.setItem('products', JSON.stringify(products));
                    loadProductsTable();
                    
                    alert(`‚úÖ Atualiza√ß√£o completa realizada!\n\n‚Ä¢ ${newProducts.length} produtos carregados do arquivo TXT\n‚Ä¢ Todos os produtos anteriores foram substitu√≠dos\n‚Ä¢ Apenas os produtos do arquivo TXT est√£o dispon√≠veis agora`);
                    
                    // Reset
                    document.getElementById('importPreview').style.display = 'none';
                    document.getElementById('txtFileInput').value = '';
                    parsedData = [];
                    
                    return;
                }
            }
            
            // FUNCIONALIDADE ORIGINAL (caso n√£o confirme a substitui√ß√£o completa)
            let importedCount = 0;
            let updatedCount = 0;
            
            parsedData.forEach(newProduct => {
                const existingIndex = products.findIndex(p => 
                    p.model === newProduct.model && 
                    p.category === newProduct.category &&
                    p.storage === newProduct.storage &&
                    p.color === newProduct.color
                );
                
                if (existingIndex !== -1) {
                    // Produto existe
                    if (updateExisting) {
                        if (updateStockOnly) {
                            products[existingIndex].quantity = newProduct.quantity;
                        } else {
                            products[existingIndex].price = newProduct.price;
                            products[existingIndex].quantity = newProduct.quantity;
                            if (newProduct.storage) products[existingIndex].storage = newProduct.storage;
                            if (newProduct.color) products[existingIndex].color = newProduct.color;
                        }
                        updatedCount++;
                    }
                } else {
                    // Produto novo
                    if (addNewProducts) {
                            const newProductObj = {
                                id: Date.now() + Math.random(),
                                category: newProduct.category,
                                model: newProduct.model,
                                storage: newProduct.storage || 'N/A',
                                ram: extractRamFromStorage(newProduct.storage || 'N/A'),
                                color: newProduct.color || 'N/A',
                                price: newProduct.price,
                                quantity: newProduct.quantity,
                                status: newProduct.quantity > 0 ? 'available' : 'no-stock'
                            };
                        products.push(newProductObj);
                        importedCount++;
                    }
                }
            });
            
            localStorage.setItem('products', JSON.stringify(products));
            loadProductsTable();
            
            let message = `Importa√ß√£o conclu√≠da!\n`;
            if (importedCount > 0) message += `‚Ä¢ ${importedCount} novos produtos adicionados\n`;
            if (updatedCount > 0) message += `‚Ä¢ ${updatedCount} produtos atualizados`;
            
            alert(message);
            
            // Reset
            document.getElementById('importPreview').style.display = 'none';
            document.getElementById('txtFileInput').value = '';
            parsedData = [];
        }

        function cancelImport() {
            document.getElementById('importPreview').style.display = 'none';
            document.getElementById('txtFileInput').value = '';
            parsedData = [];
        }

        function downloadExampleFile() {
            const exampleContent = `08 Redmi A5 128/4 preto 540
19 Redmi A5 128/4 azul 540
14 Redmi A5 128/4 gold 540
06 Redmi A5 128/4 verde 540
04 Redmi A5 64/3 gold 470
18 Redmi A5 64/3 preto 470
04 Redmi A5 64/3 azul 470
06 Redmi A4 5G 128/4 roxo 700
01 Redmi A4 5G 128/4 preto 700
14 Redmi 13 128/6 gold 630
09 Redmi 13 128/6 preto 630
03 Redmi 13 128/6 azul 630
07 Redmi 13 128/6 pink 630
08 Redmi 13 256/8 preto 730
09 Redmi 13 256/8 azul 730
07 Redmi 13 256/8 gold 730
07 Redmi 14C 128/6 azul 630
04 Redmi 14C 128/6 preto 630
06 Redmi 14C 128/6 verde 630
07 Redmi 14C 256/8 verde 730
08 Redmi 15C 128/4 preto 730
08 Redmi 15C 128/4 verde 730
08 Redmi 15C 128/4 azul 730
09 Redmi 15C 256/8 azul 840
11 Redmi 15C 256/8 preto 840
09 Redmi 15C 256/8 laranja 840
04 Redmi 15C 256/8 verde 840
14 Redmi 15 256/8 silver 900
18 Redmi 15 256/8 preto 900
03 Note 14 128/6 preto 840
05 Note 14 128/6 azul 840
02 Note 14 256/8 preto 940
04 Note 14 256/8 azul 940`;

            const blob = new Blob([exampleContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'exemplo_atualizacao_produtos.txt';
            link.click();
            URL.revokeObjectURL(url);
        }

        // Sistema de Login
        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const rememberMe = document.getElementById('rememberMe').checked;
            
            // Verificar credenciais (primeira vez usa padr√£o, depois usa banco)
            let isValid = false;
            
            // Primeira verifica√ß√£o: credenciais padr√£o
            if (username === DEFAULT_USERNAME && password === DEFAULT_PASSWORD) {
                isValid = true;
                
                // Se √© a primeira vez, salvar no banco
                if (rememberMe) {
                    await saveCredentials(username, password);
                }
            } else {
                // Verificar no banco de dados
                try {
                    if (!db) await initDatabase();
                    
                    const transaction = db.transaction(['adminCredentials'], 'readonly');
                    const store = transaction.objectStore('adminCredentials');
                    
                    const credentials = await new Promise((resolve, reject) => {
                        const request = store.get('admin');
                        request.onsuccess = () => resolve(request.result);
                        request.onerror = () => reject(request.error);
                    });
                    
                    if (credentials && credentials.username === username && credentials.password === password) {
                        isValid = true;
                        
                        if (rememberMe) {
                            await saveCredentials(username, password);
                        }
                    }
                } catch (error) {
                    console.error('Erro ao verificar credenciais:', error);
                }
            }
            
            if (isValid) {
                // Salvar credenciais se "Lembrar-me" estiver marcado
                if (rememberMe) {
                    await saveCredentials(username, password);
                } else {
                    clearCredentials();
                }
                
                document.getElementById('loginContainer').style.display = 'none';
                document.getElementById('adminPanel').style.display = 'block';
                hideMessage('errorMessage');
            } else {
                showMessage('errorMessage', 'Usu√°rio ou senha incorretos!');
            }
        });

        // Fun√ß√µes de mensagem
        function showMessage(elementId, message) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.style.display = 'block';
            setTimeout(() => hideMessage(elementId), 5000);
        }

        function hideMessage(elementId) {
            document.getElementById(elementId).style.display = 'none';
        }

        // Fun√ß√µes do formul√°rio
        function showAddForm() {
            isEditing = false;
            document.getElementById('formTitle').textContent = 'Adicionar Novo Produto';
            document.getElementById('productForm').style.display = 'block';
            document.getElementById('categoryManagement').style.display = 'none';
            document.getElementById('productFormElement').reset();
            document.getElementById('productId').value = '';
            updateCategorySelect();
        }

        function cancelForm() {
            document.getElementById('productForm').style.display = 'none';
            document.getElementById('productFormElement').reset();
        }

        // Salvar produto
        document.getElementById('productFormElement').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const product = {
                id: isEditing ? document.getElementById('productId').value : Date.now().toString(),
                category: formData.get('category'),
                model: formData.get('model'),
                storage: formData.get('storage'),
                ram: formData.get('ram'),
                color: formData.get('color'),
                price: parseFloat(formData.get('price')),
                quantity: parseInt(formData.get('quantity')),
                status: formData.get('status')
            };

            if (isEditing) {
                const index = products.findIndex(p => p.id === product.id);
                products[index] = product;
                showMessage('successMessage', 'Produto atualizado com sucesso!');
            } else {
                products.push(product);
                showMessage('successMessage', 'Produto adicionado com sucesso!');
            }

            saveProducts();
            loadProductsTable();
            cancelForm();
        });

        // Editar produto
        function editProduct(id) {
            const product = products.find(p => p.id === id);
            if (product) {
                isEditing = true;
                document.getElementById('formTitle').textContent = 'Editar Produto';
                document.getElementById('categoryManagement').style.display = 'none';
                
                // Atualizar select de categorias primeiro
                updateCategorySelect();
                
                document.getElementById('productId').value = product.id;
                document.getElementById('category').value = product.category;
                document.getElementById('model').value = product.model;
                document.getElementById('storage').value = product.storage || '';
                document.getElementById('ram').value = product.ram || '';
                document.getElementById('color').value = product.color || '';
                document.getElementById('price').value = product.price;
                document.getElementById('quantity').value = product.quantity;
                document.getElementById('status').value = product.status;
                document.getElementById('productForm').style.display = 'block';
            }
        }

        // Excluir produto
        function deleteProduct(id) {
            if (confirm('Tem certeza que deseja excluir este produto?')) {
                products = products.filter(p => p.id !== id);
                saveProducts();
                loadProductsTable();
                showMessage('successMessage', 'Produto exclu√≠do com sucesso!');
            }
        }

        // Carregar tabela de produtos
        function loadProductsTable() {
            const tbody = document.getElementById('productsTableBody');
            tbody.innerHTML = '';

            products.forEach(product => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${product.category}</td>
                    <td>${product.model}</td>
                    <td>${product.storage} / ${product.ram}</td>
                    <td>${product.color}</td>
                    <td>R$ ${product.price.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</td>
                    <td>${product.quantity}</td>
                    <td><span class="status-badge status-${product.status}">${getStatusText(product.status)}</span></td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-small" onclick="editProduct('${product.id}')">Editar</button>
                            <button class="btn btn-danger btn-small" onclick="deleteProduct('${product.id}')">Excluir</button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Fun√ß√µes auxiliares
        function getStatusText(status) {
            const statusMap = {
                'available': 'Dispon√≠vel',
                'limited': 'Poucas Unidades',
                'no-stock': 'Sem Estoque'
            };
            return statusMap[status] || status;
        }

        function saveProducts() {
            localStorage.setItem('products', JSON.stringify(products));
            // Atualizar tamb√©m a p√°gina principal se estiver aberta
            if (window.opener) {
                window.opener.location.reload();
            }
        }

        function logout() {
            document.getElementById('loginContainer').style.display = 'block';
            document.getElementById('adminPanel').style.display = 'none';
            document.getElementById('loginForm').reset();
        }

        function exportData() {
            const dataStr = JSON.stringify(products, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'produtos_loja_salles.json';
            link.click();
        }

        function importData() {
            document.getElementById('fileInput').click();
        }

        // Handle file import
        document.getElementById('fileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const importedProducts = JSON.parse(e.target.result);
                        if (confirm(`Importar ${importedProducts.length} produtos? Isso substituir√° todos os produtos atuais.`)) {
                            products = importedProducts;
                            saveProducts();
                            loadProductsTable();
                            showMessage('successMessage', `Importados ${importedProducts.length} produtos com sucesso!`);
                        }
                    } catch (error) {
                        alert('Erro ao importar arquivo. Verifique se √© um JSON v√°lido.');
                    }
                };
                reader.readAsText(file);
            }
        });

        function resetToFullList() {
            if (confirm('Tem certeza que deseja resetar para a lista completa? Isso substituir√° todos os produtos atuais.')) {
                localStorage.removeItem('products');
                loadDefaultProducts();
                loadProductsTable();
                showMessage('successMessage', 'Lista resetada com sucesso!');
            }
        }

        function loadCompleteProductList() {
            if (confirm('Carregar a lista completa com TODOS os produtos fornecidos? Isso substituir√° todos os produtos atuais.')) {
                const completeProducts = [
                    // REDMI A5
                    {id: '1', category: 'Redmi', model: 'A5', storage: '128GB', ram: '4GB', color: 'Preto', price: 540, quantity: 8, status: 'limited'},
                    {id: '2', category: 'Redmi', model: 'A5', storage: '128GB', ram: '4GB', color: 'Azul', price: 540, quantity: 19, status: 'available'},
                    {id: '3', category: 'Redmi', model: 'A5', storage: '128GB', ram: '4GB', color: 'Gold', price: 540, quantity: 14, status: 'available'},
                    {id: '4', category: 'Redmi', model: 'A5', storage: '128GB', ram: '4GB', color: 'Verde', price: 540, quantity: 6, status: 'limited'},
                    {id: '5', category: 'Redmi', model: 'A5', storage: '64GB', ram: '3GB', color: 'Gold', price: 470, quantity: 4, status: 'limited'},
                    {id: '6', category: 'Redmi', model: 'A5', storage: '64GB', ram: '3GB', color: 'Preto', price: 470, quantity: 18, status: 'available'},
                    {id: '7', category: 'Redmi', model: 'A5', storage: '64GB', ram: '3GB', color: 'Azul', price: 470, quantity: 4, status: 'limited'},
                    
                    // REDMI A4 5G
                    {id: '8', category: 'Redmi', model: 'A4 5G', storage: '128GB', ram: '4GB', color: 'Roxo', price: 700, quantity: 6, status: 'limited'},
                    {id: '9', category: 'Redmi', model: 'A4 5G', storage: '128GB', ram: '4GB', color: 'Preto', price: 700, quantity: 1, status: 'limited'},
                    
                    // REDMI 13
                    {id: '10', category: 'Redmi', model: '13', storage: '128GB', ram: '6GB', color: 'Gold', price: 630, quantity: 14, status: 'available'},
                    {id: '11', category: 'Redmi', model: '13', storage: '128GB', ram: '6GB', color: 'Preto', price: 630, quantity: 9, status: 'limited'},
                    {id: '12', category: 'Redmi', model: '13', storage: '128GB', ram: '6GB', color: 'Azul', price: 630, quantity: 3, status: 'limited'},
                    {id: '13', category: 'Redmi', model: '13', storage: '128GB', ram: '6GB', color: 'Pink', price: 630, quantity: 7, status: 'limited'},
                    {id: '14', category: 'Redmi', model: '13', storage: '256GB', ram: '8GB', color: 'Preto', price: 730, quantity: 8, status: 'limited'},
                    {id: '15', category: 'Redmi', model: '13', storage: '256GB', ram: '8GB', color: 'Azul', price: 730, quantity: 9, status: 'limited'},
                    {id: '16', category: 'Redmi', model: '13', storage: '256GB', ram: '8GB', color: 'Gold', price: 730, quantity: 7, status: 'limited'},
                    
                    // REDMI 14C
                    {id: '17', category: 'Redmi', model: '14C', storage: '128GB', ram: '6GB', color: 'Azul', price: 630, quantity: 7, status: 'limited'},
                    {id: '18', category: 'Redmi', model: '14C', storage: '128GB', ram: '6GB', color: 'Preto', price: 630, quantity: 4, status: 'limited'},
                    {id: '19', category: 'Redmi', model: '14C', storage: '128GB', ram: '6GB', color: 'Verde', price: 630, quantity: 6, status: 'limited'},
                    {id: '20', category: 'Redmi', model: '14C', storage: '256GB', ram: '8GB', color: 'Verde', price: 730, quantity: 7, status: 'limited'},
                    
                    // REDMI 15C
                    {id: '21', category: 'Redmi', model: '15C', storage: '128GB', ram: '4GB', color: 'Preto', price: 730, quantity: 8, status: 'limited'},
                    {id: '22', category: 'Redmi', model: '15C', storage: '128GB', ram: '4GB', color: 'Verde', price: 730, quantity: 8, status: 'limited'},
                    {id: '23', category: 'Redmi', model: '15C', storage: '128GB', ram: '4GB', color: 'Azul', price: 730, quantity: 8, status: 'limited'},
                    {id: '24', category: 'Redmi', model: '15C', storage: '256GB', ram: '8GB', color: 'Azul', price: 840, quantity: 9, status: 'limited'},
                    {id: '25', category: 'Redmi', model: '15C', storage: '256GB', ram: '8GB', color: 'Preto', price: 840, quantity: 11, status: 'available'},
                    {id: '26', category: 'Redmi', model: '15C', storage: '256GB', ram: '8GB', color: 'Laranja', price: 840, quantity: 9, status: 'limited'},
                    {id: '27', category: 'Redmi', model: '15C', storage: '256GB', ram: '8GB', color: 'Verde', price: 840, quantity: 4, status: 'limited'},
                    
                    // REDMI 15
                    {id: '28', category: 'Redmi', model: '15', storage: '256GB', ram: '8GB', color: 'Silver', price: 900, quantity: 14, status: 'available'},
                    {id: '29', category: 'Redmi', model: '15', storage: '256GB', ram: '8GB', color: 'Preto', price: 900, quantity: 18, status: 'available'}
                ];
                
                products = completeProducts;
                saveProducts();
                loadProductsTable();
                showMessage('successMessage', 'Lista completa carregada com sucesso!');
            }
        }

        // Carregar produtos padr√£o - Lista completa atualizada
        function loadDefaultProducts() {
            const defaultProducts = [
                // REDMI A5
                {id: '1', category: 'Redmi', model: 'A5', storage: '128GB', ram: '4GB', color: 'Preto', price: 540, quantity: 8, status: 'limited'},
                {id: '2', category: 'Redmi', model: 'A5', storage: '128GB', ram: '4GB', color: 'Azul', price: 540, quantity: 19, status: 'available'},
                {id: '3', category: 'Redmi', model: 'A5', storage: '128GB', ram: '4GB', color: 'Gold', price: 540, quantity: 14, status: 'available'},
                {id: '4', category: 'Redmi', model: 'A5', storage: '128GB', ram: '4GB', color: 'Verde', price: 540, quantity: 6, status: 'limited'},
                {id: '5', category: 'Redmi', model: 'A5', storage: '64GB', ram: '3GB', color: 'Gold', price: 470, quantity: 4, status: 'limited'},
                {id: '6', category: 'Redmi', model: 'A5', storage: '64GB', ram: '3GB', color: 'Preto', price: 470, quantity: 18, status: 'available'},
                {id: '7', category: 'Redmi', model: 'A5', storage: '64GB', ram: '3GB', color: 'Azul', price: 470, quantity: 4, status: 'limited'},
                
                // REDMI A4 5G
                {id: '8', category: 'Redmi', model: 'A4 5G', storage: '128GB', ram: '4GB', color: 'Roxo', price: 700, quantity: 6, status: 'limited'},
                {id: '9', category: 'Redmi', model: 'A4 5G', storage: '128GB', ram: '4GB', color: 'Preto', price: 700, quantity: 1, status: 'limited'},
                
                // REDMI 13
                {id: '10', category: 'Redmi', model: '13', storage: '128GB', ram: '6GB', color: 'Gold', price: 630, quantity: 14, status: 'available'},
                {id: '11', category: 'Redmi', model: '13', storage: '128GB', ram: '6GB', color: 'Preto', price: 630, quantity: 9, status: 'limited'},
                {id: '12', category: 'Redmi', model: '13', storage: '128GB', ram: '6GB', color: 'Azul', price: 630, quantity: 3, status: 'limited'},
                {id: '13', category: 'Redmi', model: '13', storage: '128GB', ram: '6GB', color: 'Pink', price: 630, quantity: 7, status: 'limited'},
                {id: '14', category: 'Redmi', model: '13', storage: '256GB', ram: '8GB', color: 'Preto', price: 730, quantity: 8, status: 'limited'},
                {id: '15', category: 'Redmi', model: '13', storage: '256GB', ram: '8GB', color: 'Azul', price: 730, quantity: 9, status: 'limited'},
                {id: '16', category: 'Redmi', model: '13', storage: '256GB', ram: '8GB', color: 'Gold', price: 730, quantity: 7, status: 'limited'},
                
                // REDMI 14C
                {id: '17', category: 'Redmi', model: '14C', storage: '128GB', ram: '6GB', color: 'Azul', price: 630, quantity: 7, status: 'limited'},
                {id: '18', category: 'Redmi', model: '14C', storage: '128GB', ram: '6GB', color: 'Preto', price: 630, quantity: 4, status: 'limited'},
                {id: '19', category: 'Redmi', model: '14C', storage: '128GB', ram: '6GB', color: 'Verde', price: 630, quantity: 6, status: 'limited'},
                {id: '20', category: 'Redmi', model: '14C', storage: '256GB', ram: '8GB', color: 'Verde', price: 730, quantity: 7, status: 'limited'},
                
                // REDMI 15C
                {id: '21', category: 'Redmi', model: '15C', storage: '128GB', ram: '4GB', color: 'Preto', price: 730, quantity: 8, status: 'limited'},
                {id: '22', category: 'Redmi', model: '15C', storage: '128GB', ram: '4GB', color: 'Verde', price: 730, quantity: 8, status: 'limited'},
                {id: '23', category: 'Redmi', model: '15C', storage: '128GB', ram: '4GB', color: 'Azul', price: 730, quantity: 8, status: 'limited'},
                {id: '24', category: 'Redmi', model: '15C', storage: '256GB', ram: '8GB', color: 'Azul', price: 840, quantity: 9, status: 'limited'},
                {id: '25', category: 'Redmi', model: '15C', storage: '256GB', ram: '8GB', color: 'Preto', price: 840, quantity: 11, status: 'available'},
                {id: '26', category: 'Redmi', model: '15C', storage: '256GB', ram: '8GB', color: 'Laranja', price: 840, quantity: 9, status: 'limited'},
                {id: '27', category: 'Redmi', model: '15C', storage: '256GB', ram: '8GB', color: 'Verde', price: 840, quantity: 4, status: 'limited'},
                
                // REDMI 15
                {id: '28', category: 'Redmi', model: '15', storage: '256GB', ram: '8GB', color: 'Silver', price: 900, quantity: 14, status: 'available'},
                {id: '29', category: 'Redmi', model: '15', storage: '256GB', ram: '8GB', color: 'Preto', price: 900, quantity: 18, status: 'available'}
            ];
            
            products = defaultProducts;
            saveProducts();
        }

        // === GERENCIAMENTO DE TAXAS DE PARCELAMENTO ===
        
        // Taxas padr√£o
        const defaultInstallmentRates = {
            mastercard: {
                1: 3.99,
                2: 5.15,
                3: 5.84,
                4: 6.52,
                5: 7.22,
                6: 7.91,
                7: 9.02,
                8: 9.73,
                9: 10.44,
                10: 10.82,
                11: 11.89,
                12: 12.62
            },
            others: {
                1: 6.03,
                2: 7.16,
                3: 7.92,
                4: 8.69,
                5: 9.46,
                6: 10.25,
                7: 11.06,
                8: 12.39,
                9: 13.19,
                10: 13.99,
                11: 14.8,
                12: 15.62
            }
        };

        // Mostrar gerenciamento de taxas
        function showInstallmentManagement() {
            document.getElementById('installmentManagement').style.display = 'block';
            document.getElementById('productForm').style.display = 'none';
            document.getElementById('categoryManagement').style.display = 'none';
            document.getElementById('txtImportSection').style.display = 'none';
            
            loadInstallmentRates();
        }

        // Esconder gerenciamento de taxas
        function hideInstallmentManagement() {
            document.getElementById('installmentManagement').style.display = 'none';
        }

        // Alternar entre abas
        function showInstallmentTab(tabName) {
            // Remover active de todos os bot√µes e conte√∫dos
            document.querySelectorAll('.installment-tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.installment-tab-content').forEach(content => content.classList.remove('active'));
            
            // Ativar aba selecionada
            document.querySelector(`[onclick="showInstallmentTab('${tabName}')"]`).classList.add('active');
            document.getElementById(`${tabName}Tab`).classList.add('active');
        }

        // Carregar taxas do localStorage
        function loadInstallmentRates() {
            const savedRates = JSON.parse(localStorage.getItem('installmentRates')) || defaultInstallmentRates;
            
            // Carregar taxas Mastercard/Visa
            for (let i = 1; i <= 12; i++) {
                const input = document.getElementById(`mastercard_${i}`);
                if (input) {
                    input.value = savedRates.mastercard[i] || '';
                }
            }
            
            // Carregar taxas Outras Bandeiras
            for (let i = 1; i <= 12; i++) {
                const input = document.getElementById(`others_${i}`);
                if (input) {
                    input.value = savedRates.others[i] || '';
                }
            }
        }

        // Salvar taxas
        function saveInstallmentRates() {
            const rates = {
                mastercard: {},
                others: {}
            };
            
            // Coletar taxas Mastercard/Visa
            for (let i = 1; i <= 12; i++) {
                const input = document.getElementById(`mastercard_${i}`);
                if (input && input.value) {
                    rates.mastercard[i] = parseFloat(input.value);
                }
            }
            
            // Coletar taxas Outras Bandeiras
            for (let i = 1; i <= 12; i++) {
                const input = document.getElementById(`others_${i}`);
                if (input && input.value) {
                    rates.others[i] = parseFloat(input.value);
                }
            }
            
            // Salvar no localStorage
            localStorage.setItem('installmentRates', JSON.stringify(rates));
            
            // Mostrar mensagem de sucesso
            alert('‚úÖ Taxas de parcelamento salvas com sucesso!');
        }

        // Resetar para taxas padr√£o
        function resetInstallmentRates() {
            if (confirm('Tem certeza que deseja resetar todas as taxas para os valores padr√£o?')) {
                localStorage.removeItem('installmentRates');
                loadInstallmentRates();
                alert('‚úÖ Taxas resetadas para os valores padr√£o!');
            }
        }
    </script>
</body>
</html>
